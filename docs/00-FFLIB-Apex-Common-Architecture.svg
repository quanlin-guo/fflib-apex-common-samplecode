<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 800">
  <!-- Background -->
  <rect width="1000" height="800" fill="#f8f9fa" />
  
  <!-- Title -->
  <text x="500" y="40" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold" fill="#333">FFLIB Apex Common Architecture - Class Diagram</text>
  
  <!-- Core FFLIB Framework -->
  <rect x="50" y="80" width="200" height="260" fill="#dae8fc" stroke="#6c8ebf" stroke-width="2" rx="5" />
  <text x="150" y="100" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold" fill="#333">Core FFLIB Framework</text>
  
  <rect x="70" y="120" width="160" height="30" fill="#ffffff" stroke="#6c8ebf" stroke-width="1" />
  <text x="150" y="140" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">fflib_Application</text>
  
  <rect x="70" y="160" width="160" height="30" fill="#ffffff" stroke="#6c8ebf" stroke-width="1" />
  <text x="150" y="180" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">fflib_SObjectDomain</text>
  
  <rect x="70" y="200" width="160" height="30" fill="#ffffff" stroke="#6c8ebf" stroke-width="1" />
  <text x="150" y="220" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">fflib_SObjectSelector</text>
  
  <rect x="70" y="240" width="160" height="30" fill="#ffffff" stroke="#6c8ebf" stroke-width="1" />
  <text x="150" y="260" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">fflib_SObjectUnitOfWork</text>
  
  <rect x="70" y="280" width="160" height="30" fill="#ffffff" stroke="#6c8ebf" stroke-width="1" />
  <text x="150" y="300" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">fflib_QueryFactory</text>
  
  <!-- Application Factory -->
  <rect x="280" y="80" width="220" height="260" fill="#d5e8d4" stroke="#82b366" stroke-width="2" rx="5" />
  <text x="390" y="100" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold" fill="#333">Application Factory</text>
  
  <rect x="300" y="120" width="180" height="160" fill="#ffffff" stroke="#82b366" stroke-width="1" />
  <text x="390" y="140" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">Application</text>
  <text x="390" y="165" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ UnitOfWork: UnitOfWorkFactory</text>
  <text x="390" y="185" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ Domain: DomainFactory</text>
  <text x="390" y="205" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ Selector: SelectorFactory</text>
  <text x="390" y="225" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ Service: ServiceFactory</text>
  <line x1="300" y1="145" x2="480" y2="145" stroke="#82b366" stroke-width="1" />
  
  <!-- Domain Layer -->
  <rect x="530" y="80" width="420" height="175" fill="#ffe6cc" stroke="#d79b00" stroke-width="2" rx="5" />
  <text x="740" y="100" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold" fill="#333">Domain Layer</text>
  
  <!-- Domain Interface -->
  <rect x="550" y="120" width="180" height="115" fill="#ffffff" stroke="#d79b00" stroke-width="1" />
  <text x="640" y="140" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">«interface»</text>
  <text x="640" y="155" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">IOpportunities</text>
  <line x1="550" y1="160" x2="730" y2="160" stroke="#d79b00" stroke-width="1" />
  <text x="640" y="175" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ applyDiscount()</text>
  <text x="640" y="195" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ getAccountIds()</text>
  <text x="640" y="215" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ generate()</text>
  
  <!-- Domain Implementation -->
  <rect x="750" y="120" width="180" height="115" fill="#ffffff" stroke="#d79b00" stroke-width="1" />
  <text x="840" y="140" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">Opportunities</text>
  <line x1="750" y1="145" x2="930" y2="145" stroke="#d79b00" stroke-width="1" />
  <text x="840" y="160" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ newInstance()</text>
  <text x="840" y="175" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ applyDiscount()</text>
  <text x="840" y="190" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ getAccountIds()</text>
  <text x="840" y="205" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ generate()</text>
  <text x="840" y="220" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ Constructor</text>
  
  <!-- Selector Layer -->
  <rect x="530" y="275" width="420" height="175" fill="#e1d5e7" stroke="#9673a6" stroke-width="2" rx="5" />
  <text x="740" y="295" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold" fill="#333">Selector Layer</text>
  
  <!-- Selector Interface -->
  <rect x="550" y="315" width="180" height="115" fill="#ffffff" stroke="#9673a6" stroke-width="1" />
  <text x="640" y="335" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">«interface»</text>
  <text x="640" y="350" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">IOpportunitiesSelector</text>
  <line x1="550" y1="355" x2="730" y2="355" stroke="#9673a6" stroke-width="1" />
  <text x="640" y="370" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ selectById()</text>
  <text x="640" y="385" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ selectByIdWithProducts()</text>
  <text x="640" y="400" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ selectOpportunityInfo()</text>
  <text x="640" y="415" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ queryLocatorReadyToInvoice()</text>
  
  <!-- Selector Implementation -->
  <rect x="750" y="315" width="180" height="115" fill="#ffffff" stroke="#9673a6" stroke-width="1" />
  <text x="840" y="335" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">OpportunitiesSelector</text>
  <line x1="750" y1="340" x2="930" y2="340" stroke="#9673a6" stroke-width="1" />
  <text x="840" y="355" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ newInstance()</text>
  <text x="840" y="370" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ getSObjectFieldList()</text>
  <text x="840" y="385" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ getSObjectType()</text>
  <text x="840" y="400" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ selectById()</text>
  <text x="840" y="415" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ selectByIdWithProducts()</text>
  
  <!-- Service Layer -->
  <rect x="530" y="470" width="420" height="175" fill="#fff2cc" stroke="#d6b656" stroke-width="2" rx="5" />
  <text x="740" y="490" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold" fill="#333">Service Layer</text>
  
  <!-- Service Interface -->
  <rect x="550" y="510" width="180" height="115" fill="#ffffff" stroke="#d6b656" stroke-width="1" />
  <text x="640" y="530" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">«interface»</text>
  <text x="640" y="545" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">IOpportunitiesService</text>
  <line x1="550" y1="550" x2="730" y2="550" stroke="#d6b656" stroke-width="1" />
  <text x="640" y="565" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ applyDiscounts()</text>
  <text x="640" y="580" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ createInvoices()</text>
  <text x="640" y="595" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ submitInvoicingJob()</text>
  
  <!-- Service Implementation -->
  <rect x="750" y="510" width="180" height="115" fill="#ffffff" stroke="#d6b656" stroke-width="1" />
  <text x="840" y="530" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">OpportunitiesServiceImpl</text>
  <line x1="750" y1="535" x2="930" y2="535" stroke="#d6b656" stroke-width="1" />
  <text x="840" y="550" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ applyDiscounts()</text>
  <text x="840" y="565" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ createInvoices()</text>
  <text x="840" y="580" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ submitInvoicingJob()</text>
  <text x="840" y="595" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">- applyDiscounts()</text>
  
  <!-- Client Layer -->
  <rect x="50" y="470" width="450" height="175" fill="#f8cecc" stroke="#b85450" stroke-width="2" rx="5" />
  <text x="275" y="490" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold" fill="#333">Client Layer</text>
  
  <!-- Controller -->
  <rect x="70" y="510" width="180" height="115" fill="#ffffff" stroke="#b85450" stroke-width="1" />
  <text x="160" y="530" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">OpportunityController</text>
  <line x1="70" y1="535" x2="250" y2="535" stroke="#b85450" stroke-width="1" />
  <text x="160" y="550" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ applyDiscount()</text>
  <text x="160" y="565" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ createInvoice()</text>
  
  <!-- Trigger Handler -->
  <rect x="300" y="510" width="180" height="115" fill="#ffffff" stroke="#b85450" stroke-width="1" />
  <text x="390" y="530" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">OpportunitiesTriggerHandler</text>
  <line x1="300" y1="535" x2="480" y2="535" stroke="#b85450" stroke-width="1" />
  <text x="390" y="550" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ onValidate()</text>
  <text x="390" y="565" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ onAfterInsert()</text>
  <text x="390" y="580" font-family="Arial" font-size="11" text-anchor="middle" fill="#666">+ Constructor</text>
  
  <!-- Relationships (Connector lines) -->
  <!-- Domain Implementation to Interface -->
  <line x1="750" y1="170" x2="730" y2="170" stroke="#333" stroke-width="1.5" />
  <polygon points="735,170 730,167 730,173" fill="#333" />
  
  <!-- Selector Implementation to Interface -->
  <line x1="750" y1="370" x2="730" y2="370" stroke="#333" stroke-width="1.5" />
  <polygon points="735,370 730,367 730,373" fill="#333" />
  
  <!-- Service Implementation to Interface -->
  <line x1="750" y1="550" x2="730" y2="550" stroke="#333" stroke-width="1.5" />
  <polygon points="735,550 730,547 730,553" fill="#333" />
  
  <!-- Application Factory to Core -->
  <line x1="280" y1="170" x2="230" y2="170" stroke="#333" stroke-width="1.5" stroke-dasharray="5,3" />
  <polygon points="235,170 230,167 230,173" fill="#333" />
  
  <!-- Controller to Service -->
  <path d="M 160 510 L 160 450 L 640 450 L 640 510" stroke="#333" stroke-width="1.5" fill="none" stroke-dasharray="5,3" />
  <polygon points="640,505 637,510 643,510" fill="#333" />
  
  <!-- Trigger Handler to Domain -->
  <path d="M 390 510 L 390 450 L 840 450 L 840 235" stroke="#333" stroke-width="1.5" fill="none" stroke-dasharray="5,3" />
  <polygon points="840,240 837,235 843,235" fill="#333" />
  
  <!-- Service to Domain -->
  <path d="M 840 510 L 840 235" stroke="#333" stroke-width="1.5" fill="none" />
  <polygon points="840,240 837,235 843,235" fill="#333" />
  
  <!-- Service to Selector -->
  <line x1="840" y1="510" x2="840" y2="430" stroke="#333" stroke-width="1.5" fill="none" />
  <polygon points="840,435 837,430 843,430" fill="#333" />
  
  <!-- Legend -->
  <rect x="50" y="670" width="900" height="80" fill="#f5f5f5" stroke="#666" stroke-width="1" rx="5" />
  <text x="500" y="690" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">Legend</text>
  
  <rect x="80" y="705" width="20" height="20" fill="#dae8fc" stroke="#6c8ebf" stroke-width="1" />
  <text x="110" y="720" font-family="Arial" font-size="12" text-anchor="start" fill="#333">Core Framework</text>
  
  <rect x="220" y="705" width="20" height="20" fill="#d5e8d4" stroke="#82b366" stroke-width="1" />
  <text x="250" y="720" font-family="Arial" font-size="12" text-anchor="start" fill="#333">Application Factory</text>
  
  <rect x="380" y="705" width="20" height="20" fill="#ffe6cc" stroke="#d79b00" stroke-width
